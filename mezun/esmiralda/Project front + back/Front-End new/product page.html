<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Page</title>
    <link rel="stylesheet" href="product page.css" />
  </head>

  <body>
  <div class="header">
  <div class="logo">E-commerce</div>

  <div class="nav-links">
    <a href="#">Home</a>
    <a href="#">Contact</a>
    <a href="#">About</a>
    <button class="shop-btn">Shop</button>
  </div>

  <div class="search-bar">
    <input type="text" placeholder="What are you looking for?" />
  </div>

  <div class="user-section">
    <img src="icons/search.svg" alt="Search" />
    <img src="icons/cart.svg" alt="Cart" />
    <img src="icons/user.svg" alt="Profile" />
    <button class="logout-btn">Log Out</button>
  </div>
</div>


    <div id="product-content" style="display: none">
      <div><img id="product-image" src="" alt="" class="ps" /></div>

      <div class="product-card">
        <div id="product-title" class="product-title">Loading...</div>
        <div class="rating">
          <span id="product-rating">★★★★☆</span>
          <span class="stock">In stock</span>
        </div>
        <div id="product-price" class="price">$0.00</div>
        <div id="product-description" class="description">
          Loading product description...
        </div>

      
        <div style="display: none;" class="quantity-section" style="margin: 20px 0">
          <label
            for="quantity"
            style="display: block; margin-bottom: 8px; font-weight: 600"
            >Quantity:</label
          >
          <div style="display: flex; align-items: center; gap: 10px">
            <button
              id="decrease-qty"
              style="
                padding: 8px 12px;
                border: 1px solid #ddd;
                background: #f8f9fa;
                cursor: pointer;
              "
            >
              -
            </button>
            <input
              type="number"
              id="quantity"
              value="1"
              min="1"
              max="99"
              style="
                width: 60px;
                padding: 8px;
                text-align: center;
                border: 1px solid #ddd;
                border-radius: 4px;
              "
            />
            <button
              id="increase-qty"
              style="
                padding: 8px 12px;
                border: 1px solid #ddd;
                background: #f8f9fa;
                cursor: pointer;
              "
            >
              +
            </button>
          </div>
        </div>
      </div>

      <button class="btn-cart" onclick="addToCart()" id="add-to-cart-btn">
        Add to cart
      </button>

      <div class="delivery-box">
        <div class="delivery-item">
          <div class="delivery-icon"></div>
          <div class="delivery-text">
            <div class="title">Free Delivery</div>
            <a href="#">Enter your postal code for Delivery Availability</a>
          </div>
        </div>
        <div class="delivery-item">
          <div class="delivery-icon"></div>
          <div class="delivery-text">
            <div class="title">Return Delivery</div>
            <a href="#">Free 30 Days Delivery Returns. Details</a>
          </div>
        </div>
      </div>
    </div>

    <div class="hepdiv">
      <div class="qr">
        <div class="qutu">.</div>
        <div class="Featured">
          <p>Related items</p>
        </div>
      </div>

      <div id="related-products" class="product-container">
        <!-- Related products will be loaded here -->
      </div>
    </div>

    <!-- Cart notification -->
    <div
      id="cart-notification"
      style="
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 15px 20px;
        border-radius: 5px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        display: none;
        animation: slideIn 0.3s ease-out;
      "
    >
      <div style="display: flex; align-items: center; gap: 10px">
        <span>✓</span>
        <div>
          <div style="font-weight: bold">Added to cart!</div>
          <div
            style="font-size: 14px; opacity: 0.9"
            id="notification-text"
          ></div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="footer-container">
        <div class="footer-box">
          <h3>Exclusive</h3>
          <p>Subscribe</p>
          <span>Get 10% off your first order</span>
          <div class="subscribe">
            <input type="email" placeholder="Enter your email" class="em" />
            <button>➤</button>
          </div>
        </div>

        <div class="footer-box">
          <h3>Support</h3>
          <p>111 Bijoy sarani, Dhaka, DH 1515, Bangladesh.</p>
          <p class="EX">exclusive@gmail.com</p>
          <p>+88015-88888-9999</p>
        </div>

        <div class="footer-box">
          <h3>Account</h3>
          <p>My Account</p>
          <p>Login / Register</p>
          <p>Cart</p>
          <p>Wishlist</p>
          <p>Shop</p>
        </div>

        <div class="footer-box">
          <h3>Quick Link</h3>
          <p>Privacy Policy</p>
          <p>Terms Of Use</p>
          <p>FAQ</p>
          <p>Contact</p>
        </div>

        <div class="footer-box">
          <h3>Download App</h3>
          <p>Save $3 with App New User Only</p>
          <div class="qr">
            <img src="fotolar/qrcode.PNG" alt="QR Code" />
            <div class="store-btns">
              <img src="fotolar/google play.PNG" alt="Google Play" />
              <img src="fotolar/app store.PNG" alt="App Store" />
            </div>
          </div>

          <div class="socials">
            <span><img src="fotolar/ftinin.PNG" alt="" class="ft" /></span>
          </div>
        </div>
      </div>
      <div class="copyright">© Copyright Rimel 2022. All right reserved</div>
    </footer>

    <style>
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      .btn-cart:disabled {
        background-color: #ccc;
        cursor: not-allowed;
        opacity: 0.6;
      }

      .quantity-section button:hover {
        background-color: #e9ecef;
      }
    </style>

    <script>
      let currentProduct = null;
      let allProducts = [];

      // Cart Management Class
      class CartManager {

        // Add item to cart (both localStorage and API)
        async addToCart(product, quantity = 1) {
          try {
            const apiSuccess = await this.addToCartAPI(product, quantity);

            return {
              success: apiSuccess,
              message: apiSuccess
                ? "Added to cart successfully!"
                : "Failed to add to cart",
            };
          } catch (error) {
            console.error("Error adding to cart:", error);
            return {
              success: false,
              message: "Error adding to cart",
            };
          }
        }
        // Add item to cart via API
        async addToCartAPI(product, quantity) {
          try {
            const username = localStorage.getItem("username");
            if (!username) throw new Error("No username in localStorage");

            const response = await fetch("http://localhost:8080/api/cart/add", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                username: username,
                productId: product.id,
              }),
            });

            if (response.ok) {
              const result = await response.text();
              console.log("Product added to cart via API:", result);
              return true;
            } else {
              console.warn(
                "API call failed:",
                response.status,
                response.statusText
              );
              return false;
            }
          } catch (error) {
            console.warn("API call failed:", error);
            return false;
          }
        }

      }

      // Initialize cart manager
      const cartManager = new CartManager();

      // Function to get URL parameter
      function getUrlParameter(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        const regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
        const results = regex.exec(location.search);
        return results === null
          ? ""
          : decodeURIComponent(results[1].replace(/\+/g, " "));
      }

      // Function to generate star rating HTML
      function generateStarRating(rating) {
        let stars = "";
        for (let i = 1; i <= 5; i++) {
          if (i <= rating) {
            stars += "★";
          } else {
            stars += "☆";
          }
        }
        return stars;
      }

      // Function to create mock products
      function createMockProducts() {
        return [
          {
            id: 1,
            name: "Wireless Headphones",
            price: 99.99,
            category: "electronics",
            rating: 5,
            brand: "AudioTech",
            image:
              "https://via.placeholder.com/500x400/ff6b6b/ffffff?text=Headphones",
            description:
              "High-quality wireless headphones with noise cancellation and superior sound quality. Perfect for music lovers and professional use. Features advanced Bluetooth 5.0 connectivity, 30-hour battery life, and premium comfort padding.",
          },
          {
            id: 2,
            name: "Cotton T-Shirt",
            price: 29.99,
            category: "clothing",
            rating: 4,
            brand: "ComfortWear",
            image:
              "https://via.placeholder.com/500x400/4ecdc4/ffffff?text=T-Shirt",
            description:
              "Comfortable 100% cotton t-shirt with soft fabric and durable construction. Available in multiple colors and sizes. Pre-shrunk fabric ensures perfect fit wash after wash. Ideal for casual wear and layering.",
          },
          {
            id: 3,
            name: "Gaming Mouse",
            price: 59.99,
            category: "electronics",
            rating: 5,
            brand: "GamePro",
            image:
              "https://via.placeholder.com/500x400/45b7d1/ffffff?text=Mouse",
            description:
              "Professional gaming mouse with RGB lighting, programmable buttons, and high-precision sensor for competitive gaming. Features 16000 DPI optical sensor, customizable weight system, and ultra-durable switches rated for 50 million clicks.",
          },
          {
            id: 4,
            name: "Summer Dress",
            price: 79.99,
            category: "clothing",
            rating: 4,
            brand: "FashionPlus",
            image:
              "https://via.placeholder.com/500x400/f9ca24/ffffff?text=Dress",
            description:
              "Elegant summer dress made from breathable fabric, perfect for casual outings and special occasions. Features flattering A-line silhouette, adjustable straps, and hidden side zipper. Machine washable and wrinkle-resistant.",
          },
          {
            id: 5,
            name: "Smartphone Case",
            price: 19.99,
            category: "electronics",
            rating: 3,
            brand: "ProtectPro",
            image:
              "https://via.placeholder.com/500x400/6c5ce7/ffffff?text=Case",
            description:
              "Protective smartphone case with shock absorption and scratch resistance. Compatible with wireless charging. Features raised edges for camera and screen protection, precise cutouts for all ports, and military-grade drop protection.",
          },
          {
            id: 6,
            name: "Running Shoes",
            price: 129.99,
            category: "shoes",
            rating: 5,
            brand: "SportMax",
            image:
              "https://via.placeholder.com/500x400/a29bfe/ffffff?text=Shoes",
            description:
              "Professional running shoes with advanced cushioning technology and breathable mesh upper for maximum comfort. Features responsive foam midsole, durable rubber outsole with excellent traction, and reflective details for low-light visibility.",
          },
          {
            id: 7,
            name: "Bluetooth Speaker",
            price: 89.99,
            category: "electronics",
            rating: 4,
            brand: "SoundWave",
            image:
              "https://via.placeholder.com/500x400/fd79a8/ffffff?text=Speaker",
            description:
              "Portable Bluetooth speaker with 360-degree sound, waterproof design, and long-lasting battery life. Features 12-hour playtime, IPX7 water resistance, built-in microphone for hands-free calls, and compact travel-friendly design.",
          },
          {
            id: 8,
            name: "Jeans",
            price: 69.99,
            category: "clothing",
            rating: 4,
            brand: "DenimCraft",
            image:
              "https://via.placeholder.com/500x400/00b894/ffffff?text=Jeans",
            description:
              "Classic denim jeans with comfortable fit and durable construction. Perfect for everyday wear and casual occasions. Features premium stretch denim, reinforced stress points, and timeless five-pocket styling. Available in multiple washes and sizes.",
          },
          {
            id: 9,
            name: "Laptop Stand",
            price: 39.99,
            category: "electronics",
            rating: 3,
            brand: "ErgoTech",
            image:
              "https://via.placeholder.com/500x400/74b9ff/ffffff?text=Stand",
            description:
              "Adjustable laptop stand with ergonomic design, heat dissipation, and stable construction for improved productivity. Features 6-level height adjustment, 360-degree rotation, foldable design for portability, and non-slip silicone pads.",
          },
          {
            id: 10,
            name: "Winter Jacket",
            price: 159.99,
            category: "clothing",
            rating: 5,
            brand: "WarmTech",
            image:
              "https://via.placeholder.com/500x400/55a3ff/ffffff?text=Jacket",
            description:
              "Warm winter jacket with water-resistant fabric, insulated lining, and multiple pockets for outdoor activities. Features down insulation, detachable hood, storm flaps, and reinforced wear areas. Perfect for cold weather adventures.",
          },
          {
            id: 11,
            name: "Smart Watch",
            price: 199.99,
            category: "electronics",
            rating: 5,
            brand: "TechWatch",
            image:
              "https://via.placeholder.com/500x400/e17055/ffffff?text=Watch",
            description:
              "Advanced smartwatch with fitness tracking, heart rate monitoring, GPS, and smartphone connectivity features. Includes sleep tracking, workout modes, water resistance up to 50m, and 7-day battery life. Compatible with iOS and Android.",
          },
          {
            id: 12,
            name: "Casual Sneakers",
            price: 89.99,
            category: "shoes",
            rating: 4,
            brand: "ComfortStep",
            image:
              "https://via.placeholder.com/500x400/00cec9/ffffff?text=Sneakers",
            description:
              "Stylish casual sneakers with comfortable sole and versatile design suitable for daily wear and light activities. Features memory foam insole, breathable canvas upper, and durable rubber outsole. Perfect for casual outfits and weekend activities.",
          },
        ];
      }

      // Function to load product data
      async function loadProductData(productId) {
        showLoading();

        try {
          // Try to fetch from server first
          const response = await fetch(
            `http://localhost:8080/api/products/${productId}`
          );

          if (!response.ok) {
            throw new Error("Product not found on server");
          }

          const product = await response.json();
          currentProduct = product;
          console.log("Product loaded from server:", product);
        } catch (error) {
          console.warn(
            "Failed to load product from server, using mock data:",
            error
          );

          // Fallback to mock data
          allProducts = createMockProducts();
          currentProduct = allProducts.find((p) => p.id == productId);

          if (!currentProduct) {
            showError();
            return;
          }
        }

        displayProduct(currentProduct);
        await loadRelatedProducts();
      }

      // Function to load all products for related items
      async function loadAllProducts() {
        try {
          const response = await fetch("http://localhost:8080/api/products");
          if (!response.ok) {
            throw new Error("Failed to fetch products");
          }
          allProducts = await response.json();
        } catch (error) {
          console.warn(
            "Failed to load products from server, using mock data:",
            error
          );
          allProducts = createMockProducts();
        }
      }

      // Function to load related products
      async function loadRelatedProducts() {
        if (allProducts.length === 0) {
          await loadAllProducts();
        }

        // Filter related products (same category, excluding current product)
        const relatedProducts = allProducts
          .filter(
            (product) =>
              product.category === currentProduct.category &&
              product.id !== currentProduct.id
          )
          .slice(0, 4); // Limit to 4 related products

        displayRelatedProducts(relatedProducts);
      }

      // Function to display product details
      function displayProduct(product) {
        document.getElementById("product-title").textContent = product.name;
        document.getElementById(
          "product-price"
        ).textContent = `$${product.price}`;
        document.getElementById("product-description").textContent =
          product.description;
        document.getElementById("product-rating").textContent =
          generateStarRating(product.rating);
        document.getElementById("product-image").src = product.image;
        document.getElementById("product-image").alt = product.name;

        // Update page title
        document.title = `${product.name} - Product Page`;

        showProductContent();
        setupQuantityControls();
      }

      // Function to setup quantity controls
      function setupQuantityControls() {
        const quantityInput = document.getElementById("quantity");
        const decreaseBtn = document.getElementById("decrease-qty");
        const increaseBtn = document.getElementById("increase-qty");

        decreaseBtn.addEventListener("click", () => {
          const currentValue = parseInt(quantityInput.value);
          if (currentValue > 1) {
            quantityInput.value = currentValue - 1;
          }
        });

        increaseBtn.addEventListener("click", () => {
          const currentValue = parseInt(quantityInput.value);
          if (currentValue < 99) {
            quantityInput.value = currentValue + 1;
          }
        });

        quantityInput.addEventListener("change", () => {
          const value = parseInt(quantityInput.value);
          if (isNaN(value) || value < 1) {
            quantityInput.value = 1;
          } else if (value > 99) {
            quantityInput.value = 99;
          }
        });
      }

      // Function to display related products
      function displayRelatedProducts(products) {
        const container = document.getElementById("related-products");
        container.innerHTML = "";

        products.forEach((product) => {
          const productHTML = `
          <div class="product-cardd" onclick="goToProduct(${
            product.id
          })" style="cursor: pointer;">
            <img width="100px" src="${product.image}" alt="${product.name}">
            <div class="title">${product.name}</div>
            <div>
              <span class="price">$${product.price}</span>
            </div>
            <div class="rating">${generateStarRating(product.rating)}</div>
          </div>
        `;
          container.insertAdjacentHTML("beforeend", productHTML);
        });
      }

      // Function to navigate to another product
      function goToProduct(productId) {
        window.location.href = `product page.html?id=${productId}`;
      }

      // Function to add product to cart
      async function addToCart() {
        if (!currentProduct) return;

        const addButton = document.getElementById("add-to-cart-btn");
        const quantityInput = document.getElementById("quantity");
        const quantity = parseInt(quantityInput.value) || 1;

        // Disable button during processing
        addButton.disabled = true;
        addButton.textContent = "Adding...";

        try {
          const result = await cartManager.addToCart(currentProduct, quantity);

          if (result.success) {
            showNotification(
              `${currentProduct.name}`,
              `Quantity: ${quantity} added to cart`,
              result.apiSuccess ? "success" : "warning"
            );

            // Reset quantity to 1 after successful add
            quantityInput.value = 1;
          } else {
            showNotification("Error", result.message, "error");
          }
        } catch (error) {
          console.error("Error adding to cart:", error);
          showNotification("Error", "Failed to add product to cart", "error");
        } finally {
          // Re-enable button
          addButton.disabled = false;
          addButton.textContent = "Add to cart";
        }
      }

      // Function to show notification
      function showNotification(title, message, type = "success") {
        const notification = document.getElementById("cart-notification");
        const notificationText = document.getElementById("notification-text");

        // Set colors based on type
        const colors = {
          success: "#28a745",
          warning: "#ffc107",
          error: "#dc3545",
        };

        notification.style.backgroundColor = colors[type] || colors.success;
        notification.querySelector("div > div:first-child").textContent = title;
        notificationText.textContent = message;

        // Show notification
        notification.style.display = "block";

        // Hide after 4 seconds
        setTimeout(() => {
          notification.style.animation = "slideOut 0.3s ease-in";
          setTimeout(() => {
            notification.style.display = "none";
            notification.style.animation = "slideIn 0.3s ease-out";
          }, 300);
        }, 4000);
      }

      // UI state management functions
      function showLoading() {
        document.getElementById("loading").style.display = "block";
        document.getElementById("error").style.display = "none";
        document.getElementById("product-content").style.display = "none";
      }

      function showError() {
        document.getElementById("loading").style.display = "none";
        document.getElementById("error").style.display = "block";
        document.getElementById("product-content").style.display = "none";
      }

      function showProductContent() {
        document.getElementById("loading").style.display = "none";
        document.getElementById("error").style.display = "none";
        document.getElementById("product-content").style.display = "block";
      }

      // Initialize page when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        const productId = getUrlParameter("id");

        if (!productId) {
          showError();
          return;
        }

        console.log("Loading product with ID:", productId);
        loadProductData(productId);
      });

      // Make cartManager available globally for other scripts
      window.cartManager = cartManager;
    </script>
    <script src="./scripts/navbar.js"></script>
  </body>
</html>
